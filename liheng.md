#问题
1、对于广告RTB业务模式和服务场景的扩展了解
2、针对一些典型技术场景和难点或者特定场景功能的技术方案设计和方案
a. 针对广告对竞价广告的可配置式的频次控制。例如：控制某广告1天内针对每个用户最多3次展示
b. 实现多节点多实例中，整体控制广告预算的消耗，避免超预算花费（PS：部分广告延迟曝光可能导致真实消费延迟达到）
c. 针对大量设备ID的标签数据的存储结构设计

方案尽量可能包含但不限于：方案思路设计、伪代码等

#广告RTB
简介视频
How Does Real-Time Bidding Work? | Explained in Under 5 Minutes https://www.youtube.com/watch?v=ylhKJSrxutM
How an Ad is Served with Real Time Bidding (RTB) - IAB Digital Simplified https://www.youtube.com/watch?v=-Glgi9RRuJs

互联网中常见的六种付费推广广告模式 https://www.nnbiog.cn/1907.html\
互联网广告付费模式专业术语大盘点：CPC、CPM、CPT…… http://www.woshizmt.cn/dsp/bdfeed/724.html

SSP(supply side platform) 内容平台,投放广告的场所,提供浏览广告的用户
AdEx(advertisement exchange) 促成SSP和DSP进行交易的交易所,力恒属于这种类型的参与者.
DSP(demand side platform) 广告主,将广告投放到其他平台

#对于广告RTB业务模式和服务场景的扩展了解
RTB(Real Time Binding),是一种互联网广告投放的模式, 其他的主流互联网广告投放模式包括CPM(cost per mille,每千次展示付费),CPC(cost per click,每次点击付费),Monthly/Daily Flat(包月包天).
RTB的主要过程如下,用户先登入SSP的网站(APP),SSP对此用户产生一个广告供应,将这个卖单连同用户画像(年龄,性别,兴趣,职业等)在AdEx下卖单,同时DSP也在AdEx对广告投放的目标客户(指定的年龄,性别,兴趣等特征)下买单,由AdEx作为交易所实时撮合成交(类似股票交易所).成交后,SSP直接从DSP处获取广告物料发送到用户处,广告就直接展示在了用户的终端上.
整个过程的时间是很短的,近似实时,在SSP的服务器收到用户的请求时就会同时向AdEx下单,完成交易后,SSP会把DSP的广告连同自己的内容一起响应给用户(或者下发广告链接客户端自行请求),整个过程是百毫秒级的.
RTB相对于其他的广告投放模式,主要有精准投放,自动化,成本低的优势.精准投放来自于每个订单都附带了目标用户的信息,不是目标客户可以不向其投放广告.由于整个过程都是在交易所买卖双方自动找寻最佳匹配成交的,能够节约大量谈判广告合同的人力.成本低来自于不会把广告预算花在非目标客户上,节约了经费.

在技术上,RTB业务实现的主要难点在于实时性,需要延迟足够短,在数十毫秒左右,否则会影响SSP端的用户体验.一般用CDN动态接入加速,调整接入网关的网络协议参数,拉专线,或者直接用云服务提供商的设施等手段降低延迟.

#针对广告对竞价广告的可配置式的频次控制。例如：控制某广告1天内针对每个用户最多3次展示
方案1:
使用redis存储某一个广告向某个用户展示了多少次,用"广告id_用户id"作为key,value是展示的次数.用lua脚本操作redis实现cas操作,超过限制就不向用户投放广告即可.
方案2:
广告投放服务部署成stateful set,请求路由按照广告id或者用户id做hash路由,保证同一个广告/用户总会路由到同一个实例,在对应服务实例内缓存对于某个用户,某个广告投放的数目.同时定期把缓存同步到外部存储,服务挂了或者扩缩容从外部存储拉缓存.

配置可以通过etcd或者kubernetes的configmap存储

#实现多节点多实例中，整体控制广告预算的消耗，避免超预算花费（PS：部分广告延迟曝光可能导致真实消费延迟达到）
这个问题跟上面那个问题感觉本质是一样的,还是题目没说清楚?无非就是控制每个广告向每个用户展示的次数,只要控制了向用户投放的次数,即使延迟曝光也没有问题,因为用户看到的次数不可能比投放的次数更多.因此方案也和上面一样

#针对大量设备ID的标签数据的存储结构设计
方案1:
用mongodb存储设备id的所有标签,每一个设备id上绑定的标签存入一个document.mongodb自身支持搜索,可以很容易检索出有哪些设备id绑定了指定标签.mongodb本来就支持分布式,容也很容易.

方案2:
用关系型数据表存储设备标签,每一行记录为(设备id, 标签名称, 标签类型).可以用tidb这样的new sql数据库存储,很容易扩容,查询依旧使用sql即可.